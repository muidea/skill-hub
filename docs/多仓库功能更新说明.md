# 多仓库功能更新说明

## 概述

skill-hub 已成功过渡到多仓库架构，移除了所有单仓库模式的向后兼容代码。现在完全支持同时管理多个技能仓库。

## 主要变更

### 1. 架构变更
- **目录结构**：`~/.skill-hub/repositories/{repo-name}/` 替代原来的 `~/.skill-hub/repo/`
- **默认仓库**：名为 "main" 的仓库作为默认归档仓库
- **配置结构**：使用 `multi_repo` 配置节管理多个仓库

### 2. 新增命令组：`repo`

新增 `skill-hub repo` 命令组用于管理多个Git仓库：

#### `skill-hub repo add <name> <url>`
添加新的Git仓库到技能库。支持从多个来源获取技能：
- 个人仓库：您自己的技能集合
- 社区仓库：开源技能集合
- 官方仓库：skill-hub官方维护的技能

#### `skill-hub repo list`
列出所有已配置的Git仓库，显示仓库状态和基本信息。

#### `skill-hub repo remove <name>`
从配置中移除指定的仓库。

#### `skill-hub repo enable <name>` / `skill-hub repo disable <name>`
启用或禁用指定的仓库。禁用后，该仓库中的技能不会出现在技能列表中。

#### `skill-hub repo default <name>`
设置默认仓库（归档仓库）。所有通过 `feedback` 命令修改的技能都会归档到默认仓库。

#### `skill-hub repo sync [name]`
同步指定仓库或所有启用的仓库。

### 3. 现有命令更新

#### `skill-hub init`
- 现在创建多仓库目录结构
- 默认创建名为 "main" 的本地仓库
- 如提供Git URL，则克隆到默认仓库

#### `skill-hub list`
- 显示所有已启用仓库中的技能
- 技能列表标注技能所属的仓库名称

#### `skill-hub feedback`
- 技能会被归档到默认仓库
- 如果技能在默认仓库中不存在则新增，存在则覆盖更新

### 4. 向后兼容性

**已移除单仓库向后兼容性**：
- 不再支持旧的 `~/.skill-hub/repo/` 目录结构
- 配置文件不再包含 `repo_path`、`git_remote_url`、`git_branch` 等单仓库字段
- 所有代码已更新为只支持多仓库模式

## 使用示例

### 初始化多仓库环境
```bash
# 初始化skill-hub（创建默认main仓库）
skill-hub init

# 添加社区仓库
skill-hub repo add community https://github.com/skill-hub-community/awesome-skills.git

# 添加个人仓库
skill-hub repo add personal git@github.com:yourname/skills.git --type user

# 设置main为默认仓库
skill-hub repo default main

# 列出所有仓库
skill-hub repo list
```

### 多仓库技能管理
```bash
# 查看所有仓库中的技能
skill-hub list

# 从社区仓库使用技能
skill-hub use community-skill

# 修改并归档到默认仓库
skill-hub feedback my-skill

# 同步所有仓库
skill-hub repo sync
```

## 测试状态

所有测试均已通过：
- ✅ Go单元测试：全部通过
- ✅ e2e测试：80个测试全部通过（100%通过率）
- ✅ 手动测试：完整工作流程测试成功

## 更新记录

- **2026-02-17**：完成多仓库架构过渡，移除单仓库向后兼容代码
- **2026-02-17**：添加 `repo` 命令组，更新命令规范文档
- **2026-02-17**：所有测试通过，功能完整